{% extends "base.html" %}
{% block title %} Isle Be There{% endblock %}

{% block content %}
<style>
    .hero-section{
        height: 100vh;
        width: 100%;
        position: relative;
    }

    #heroCarousel,
    #heroCarousel .carousel-inner,
    #heroCarousel .carousel-item {
        height: 100%;
        width: 100%;
    }

    #heroCarousel .carousel-item{
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }

    #heroCarousel .carousel-item::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1;
    }

    .hero-content-overlay .container{
        pointer-events: auto;
    }

    .hero-title{
        font-size: 3rem;
        font-weight: bold;
        text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.7);
    }

    .hero-subtitle{
        font-size: 1.5rem;
        margin-bottom: 2rem;
        text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.7);
    }

    .itinerary-btn{
        background-color: #ff6b6b;
        color: white;
        padding: 12px 30px;
        border-radius: 50px;
        text-decoration: none;
        font-weight: bold;
        transition: 0.3;
        display: inline-block;
    }

    .itinerary-btn:hover{
        background: #ff5252;
        color: white;
    }

    .carousel-control-prev, .carousel-control-next,
    .carousel-indicators{
        z-index: 3;
    }
</style>
<section class="hero-section">
    <div id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="0" class="active"></button>

            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="1" ></button>

            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="2" ></button>

            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="3" ></button>

            <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="4"></button>

        </div>

        <div class="carousel-inner">
            <div class="carousel-item active" style="background-image: url('../static/images/trinidad.jpg'); background-size:cover; background-position:center;"></div>

            <div class="carousel-item" style="background-image: url('../static/images/barbados.jpg'); background-size:cover; background-position:center;"></div>

            <div class="carousel-item" style="background-image: url('../static/images/carib-bkg.jpg'); background-size:cover; background-position:center;"></div>

            <div class="carousel-item" style="background-image: url('../static/images/beach-bkg.jpg'); background-size:cover; background-position:center;"></div>

            <div class="carousel-item" style="background-image: url('../static/images/island-bkg.jpg'); background-size:cover; background-position:center;"></div>

        </div>

        <div class="hero-content-overlay"">
            <div class="container">
                <h1 class="hero-title">Discover the Paradise of the Caribbean Islands</h1>
                <p class="hero-subtitle">Experience a once in a life time trip to the hidden gems of the Caribbean</p>

                <div class="itinerary-nav">
                    <a href="#" class="itinerary-btn">
                        <i class="fas fa-list"></i>
                        PLAN YOUR TRIP NOW
                    </a>

                </div>
            </div>

        </div>

    </div>

</section>
{% endblock %}






{% block modals %}
{% if show_interests %}
<div class="modal fade" id="interestsModal" tabindex="-1" aria-labelledby="interestsModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="interestsModalLabel">Tell us your interest</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" id="closeModalX"></button>

            </div>
            <div class="modal-body">
                <p class="mb-3">Select your interest to help us personalize your experience</p>
                {% set categories = {} %}
                {% for interest in interests %}
                    {% set category = interest.get('category', 'Other') %}
                    {% if category not in categories %}
                        {% set _ = categories.update({category: []}) %}
                    {% endif %}
                    {% set _ = categories[category].append(interest) %}
                {% endfor %}

                <div id="categorySteps">
                    {% for category, items in categories.items() %}
                        <div class="category-step" data-category="{{category}}" {% if not loop.first %}style="display: none;"{% endif %}>
                            <h6 class="fw-semibold mb-3 text-uppercase">{{category}}</h6>
                            <div class="row row-cols-1 row-cols-md-3 g-2">
                                {% for interest in items %}
                                    <div class="col">
                                        <input class="btn-check" type="checkbox" value="{{ interest.get('id')}}" name="interests" id="interest_{{interest.get('id')}}" autocomplete="off">
                                        <label class="btn btn-outline-primary w-100" for="interest_{{interest.get('id')}}">{{interest.get('name')}}</label>
                                    

                                    </div>
                                {% endfor %}
                            </div>

                        </div>
                    {% endfor %}
                </div>
                <div class="text-center mt-3 text-muted small" id="stepIndicator"></div>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" id="prevBtn" style="display:none;">Previous</button>

                <div class="ms-auto">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="skipBtn">Skip</button>
                    <button type="button" class="btn btn-primary" id="nextBtn">Next</button>
                </div>
                
                

            </div>

        </div>
    </div>

</div>
{% endif %}
{% endblock %}

{% block scripts %}
{{ super() }}
{% if show_interests %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var interestModalEl = document.getElementById("interestsModal");
        if (!interestModalEl) return;
            var interestModal = new bootstrap.Modal(interestModalEl, {
                backdrop: 'static',
                keyboard: false
            });
            interestModal.show();

            var steps = document.querySelectorAll('.category-step');
            var currentStep = 0;
            var totalSteps = steps.length;
            var prevBtn = document.getElementById('prevBtn');
            var nextBtn = document.getElementById('nextBtn');
            var stepIndicator = document.getElementById('stepIndicator');

            function updateStep() {
                steps.forEach(step => step.style.display = 'none');
                steps[currentStep].style.display = 'block';

                if (currentStep === 0){
                    prevBtn.style.display = 'none';
                }else{
                    prevBtn.style.display = 'inline-block';
                }

                if (currentStep === totalSteps - 1){
                    nextBtn.textContent = 'Save';
                }else{
                    nextBtn.textContent = 'Next';
                }

                stepIndicator.textContent = `Category ${currentStep + 1} of ${totalSteps}`;
            }

            nextBtn.addEventListener('click', function() {
                if(currentStep < totalSteps - 1){
                    currentStep++;
                    updateStep();
                }else{
                    var selected = [];
                    document.querySelectorAll('#categorySteps input[name="interests"]:checked').forEach(function(cb){
                        selected.push(cb.value);
                    });
                    fetch('{{url_for("main.save_interests")}}',{
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({interests: selected})
                    })
                    .then(response => response.json())
                    .then(data => {
                        if(data.success) {
                            location.reload();
                        }
                    })
                    .catch(error => console.error('Error:', error));
                }
            });

            prevBtn.addEventListener('click', function(){
                if(currentStep > 0){
                    currentStep--;
                    updateStep();
                }
            });



            document.getElementById('skipBtn').addEventListener('click', function() {
                fetch('{{url_for("main.skip_interests")}}', {method:'POST'})
                .then(response => response.json())
                .then(data => {
                    if(data.success) {
                        interestModal.hide();
                    }
                })
                .catch(error => console.error("Error: ", error));
            });

            document.getElementById('closeModalX').addEventListener('click', function() {
                fetch('{{url_for("main.skip_interests")}}', {method: 'POST'})
                .then(response => response.json())
                .then(data => {
                    if( data.success) {
                        interestModal.hide();
                    }
                })
                .catch(error => console.error('Error: ', error));
            });

            if(totalSteps > 0){
                updateStep();
            }

            
        
    });

    
</script>
{% endif %}
{% endblock %}
