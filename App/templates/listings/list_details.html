{% extends "base.html" %} 
{% block title %}{{ listing.title or 'Listing Details'}} - Isle Be There{% endblock %} 
{% block head %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
     integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
     crossorigin=""/>
<style>
  .details-section {
    padding: 2rem 0;
    min-height: calc(100vh - 70px);
  }

  .details-card,
  .info-card {
    background: rgba(255, 255, 255, 0.78);
    border: 1px solid rgba(15, 23, 42, 0.12);
    border-radius: 16px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);
  }

  .details-card {
    overflow: hidden;
  }

  .hero-image {
    width: 100%;
    height: 380px;
    object-fit: cover;
    background: linear-gradient(
      135deg,
      rgba(30, 144, 255, 0.3),
      rgba(32, 201, 151, 0.3)
    );
  }

  .details-content {
    padding: 1.5rem;
  }

  .badge-type {
    display: inline-block;
    padding: 0.35rem 0.9rem;
    border-radius: 999px;
    background: rgba(224, 242, 254, 0.9);
    color: #0c4a6e;
    font-size: 0.85rem;
    margin-bottom: 0.75rem;
  }

  .title-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .listing-title {
    color: #0f172a;
    font-size: 2rem;
    margin: 0;
  }

  .listing-price {
    color: #0f766e;
    font-weight: 700;
    font-size: 1.5rem;
    margin: 0;
  }

  .meta {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    color: #334155;
    margin: 1rem 0;
  }

  .info-card {
    padding: 1.25rem;
    margin-bottom: 1rem;
  }

  .info-card h4 {
    margin-top: 0;
    margin-bottom: 0.75rem;
    color: #0f172a;
  }

  .info-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 0.75rem;
  }

  .info-item {
    background: rgba(15, 23, 42, 0.04);
    border: 1px solid rgba(15, 23, 42, 0.08);
    border-radius: 10px;
    padding: 0.75rem;
  }

  .info-label {
    display: block;
    color: #64748b;
    font-size: 0.82rem;
    margin-bottom: 0.2rem;
  }

  .info-value {
    color: #0f172a;
    font-weight: 600;
  }

  .cta-btn {
    width: 100%;
    padding: 0.9rem 1rem;
    border-radius: 10px;
    border: none;
    background: linear-gradient(
      135deg,
      rgba(30, 144, 255, 0.85),
      rgba(32, 201, 151, 0.85)
    );
    color: white;
    font-weight: 700;
    text-decoration: none;
    display: inline-block;
    text-align: center;
    transition: transform 0.2s ease;
  }

  .cta-btn:hover {
    transform: translateY(-2px);
    color: white;
  }

  #map { height: 500px; }
</style>
{% endblock %}

{% block content %}
{% set bt_name = (listing.business_types.name if listing.business_types else '') %}
{% set bt = bt_name|lower %}
{% set addr = listing.address or {} %}

<section class="details-section">
  <div class="container">
    <div class="row g-4">
      <div class="col-lg-8">
        <div class="details-card">
          {% if listing.image_urls %}
          <div
            id="listingCarousel"
            class="carousel slide"
            data-bs-ride="carousel"
          >
            <!-- Indicators -->
            <div class="carousel-indicators">
              {% for img_url in listing.image_urls %}
              <button
                type="button"
                data-bs-target="#listingCarousel"
                data-bs-slide-to="{{ loop.index0 }}"
                class="{% if loop.first %}active{% endif %}"
                aria-current="{% if loop.first %}true{% endif %}"
                aria-label="Slide {{ loop.index }}"
              ></button>
              {% endfor %}
            </div>

            <!-- Slides -->
            <div class="carousel-inner">
              {% for img_url in listing.image_urls %}
              <div class="carousel-item {% if loop.first %}active{% endif %}">
                <img
                  src="{{ img_url }}"
                  class="d-block w-100 hero-image"
                  alt="Listing Image {{ loop.index }}"
                />
              </div>
              {% endfor %}
            </div>

            <!-- Controls -->
            <button
              class="carousel-control-prev"
              type="button"
              data-bs-target="#listingCarousel"
              data-bs-slide="prev"
            >
              <span
                class="carousel-control-prev-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button
              class="carousel-control-next"
              type="button"
              data-bs-target="#listingCarousel"
              data-bs-slide="next"
            >
              <span
                class="carousel-control-next-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
          {% else %}
          <div
            class="hero-image d-flex align-items-center justify-content-center text-muted"
          >
            <i class="fas fa-image fa-3x"></i>
          </div>
          {% endif %}

          <div class="details-content">
            <span class="badge-type">{{ bt_name or 'Other' }}</span>
            <div class="title-row">
              <h1 class="listing-title">
                {{ listing.title or 'Untitled Listing' }}
              </h1>
              <p class="listing-price">
                ${{ "%.2f"|format(listing.base_price or 0) }}
              </p>
            </div>

            <div class="meta">
              <span
                ><i class="fas fa-star"></i> {{ listing.rating or 'N/A' }}</span
              >
              {% if addr %}
              <span>
                <i class="fas fa-location-dot"></i>
                {% if addr.street_number %}
					{{ addr.street_number }} 
				{% endif %}
				{% if addr.street %}
					{{ addr.street }}, 
				{% endif %}
				{% if addr.city %}
				{{ addr.city }},
				{% endif %}
				{% if addr.state %}
				{{ addr.state }},
				{% endif %}
				{% if addr.country %}
				{{ addr.country }},
				{% endif %}
				{% if addr.postal_code %}
				{{ addr.postal_code }}
				{% endif %}
              </span>
              {% endif %}
            </div>

    

            <p>{{ listing.description or 'No description available.' }}</p>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="info-card">
          <h4>Book this listing</h4>
          <a
            class="cta-btn"
            href="{{ url_for('bookings.checkout', listing_id=listing.id) }}"
            >Continue to Booking</a
          >
        </div>

        <div class="info-card">
          <h4>Address</h4>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Street Number</span>
              <span class="info-value">{{ addr.street_number or 'N/A' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Street</span>
              <span class="info-value">{{ addr.street or 'N/A' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">City</span>
              <span class="info-value">{{ addr.city or 'N/A' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">State</span>
              <span class="info-value">{{ addr.state or 'N/A' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Country</span>
              <span class="info-value">{{ addr.country or 'N/A' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Postal Code</span>
              <span class="info-value">{{ addr.postal_code or 'N/A' }}</span>
            </div>
          </div>
        </div>

        {% if bt == 'hotel' %}
        <div class="info-card">
          <h4>Hotel Details</h4>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Check-in</span>
              <span class="info-value"
                >{{ listing_details.check_in_time or 'Not set' }}</span
              >
            </div>
            <div class="info-item">
              <span class="info-label">Check-out</span>
              <span class="info-value"
                >{{ listing_details.check_out_time or 'Not set' }}</span
              >
            </div>
            <div class="info-item">
              <span class="info-label">Star level</span>
              <span class="info-value"
                >{{ listing_details.star_level or 'N/A' }}</span
              >
            </div>
            <div class="info-item">
              <span class="info-label">Rooms</span>
              <span class="info-value"
                >{{ listing_details.room_count or 'N/A' }}</span
              >
            </div>
          </div>
        </div>
        {% elif bt == 'tour' %}
        <div class="info-card">
          <h4>Tour Details</h4>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Duration</span>
              <span class="info-value"
                >{{ listing.duration_minutes or 'N/A' }} mins</span
              >
            </div>
            <div class="info-item">
              <span class="info-label">Group size</span>
              <span class="info-value"
                >{{ listing.max_group_size or 'N/A' }}</span
              >
            </div>
            <div class="info-item">
              <span class="info-label">Meeting point</span>
              <span class="info-value"
                >{{ listing.meeting_point or 'Not set' }}</span
              >
            </div>
            <div class="info-item">
              <span class="info-label">Transport</span>
              <span class="info-value"
                >{{ 'Included' if listing.includes_transport else 'Not included'
                }}</span
              >
            </div>
          </div>
        </div>
        {% elif bt == 'restaurant' %}
        <div class="info-card">
          <h4>Restaurant Details</h4>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Cuisine</span>
              <span class="info-value"
                >{{ listing.cuisine_type or 'N/A' }}</span
              >
            </div>
            <div class="info-item">
              <span class="info-label">Reservations</span>
              <span class="info-value"
                >{{ 'Yes' if listing.accepts_reservations else 'No' }}</span
              >
            </div>
            <div class="info-item">
              <span class="info-label">Price range</span>
              <span class="info-value">{{ listing.price_range or 'N/A' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Dress code</span>
              <span class="info-value">{{ listing.dress_code or 'N/A' }}</span>
            </div>
          </div>
        </div>
        {% elif bt == 'activity' %}
        <div class="info-card">
          <h4>Activity Details</h4>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Duration</span>
              <span class="info-value"
                >{{ listing.duration_minutes or 'N/A' }} mins</span
              >
            </div>
            <div class="info-item">
              <span class="info-label">Difficulty</span>
              <span class="info-value">{{ listing.difficulty or 'N/A' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Minimum age</span>
              <span class="info-value">{{ listing.min_age or 'N/A' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Equipment</span>
              <span class="info-value"
                >{{ 'Provided' if listing.equipment_provided else 'Bring your
                own' }}</span
              >
            </div>
          </div>
        </div>
        {% else %}
        <div class="info-card">
          <h4>Listing Details</h4>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Category</span>
              <span class="info-value">{{ bt_name or 'Other' }}</span>
            </div>
            <div class="info-item">
              <span class="info-label">Base price</span>
              <span class="info-value"
                >${{ "%.2f"|format(listing.base_price or 0) }}</span
              >
            </div>
          </div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
  {% if listing.latitude and listing.longitude %}
	<div class="row mt-5 justify-content-center">
	<div class="col-lg-10">
		<div class="details-card p-3">
		<h4 class="mb-3">
			<i class="fas fa-location-dot me-2"></i>Location
		</h4>
		<div id="map" class="map-container"></div>
		</div>
	</div>
	</div>
	{% endif %}

</div> <!-- End container -->
</section>
{% endblock %}
{% block scripts %}
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
     integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
     crossorigin=""></script>
<script>
  var map = L.map('map').setView([{{ listing.latitude }}, {{ listing.longitude }}], 13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: 'Â© OpenStreetMap contributors'
  }).addTo(map);
  L.marker([{{ listing.latitude }}, {{ listing.longitude }}]).addTo(map)
    .bindPopup('{{ listing.title }}')
    .openPopup();
</script>
{% endblock %}
